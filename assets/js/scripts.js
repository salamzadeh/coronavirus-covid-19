var app={map:document.querySelector('.canvas_map'),widgets:document.querySelectorAll('.covid19-item'),error:function(text){var message=document.createElement('p');message.textContent='Sorry, something went wrong. Try again.';var header=document.querySelector('.header_nCoV');header.appendChild(message);console.error('Error:',text)},set_color:function(element,cases){cases=parseInt(cases);for(var i=1;i<6;i++){var step=Math.pow(10,i);if(cases<=step){return element.setAttribute('data-infected',i)}}
return element.setAttribute('data-infected',6)},hide_lads:function(region){var lands=app.map.querySelectorAll('svg [data-infected]');for(var i=0;i<lands.length;i++){var selected=app.map.querySelector('svg [title="'+region+'"]');if(lands[i]!==selected){lands[i].removeAttribute('data-infected')}}},land:function(e){e.preventDefault();var title=this.getAttribute('title');var tr=document.querySelector('tr[data-region="'+title+'"]');if(tr){app.row.call(tr,{preventDefault:function(){}});if(typeof tr.scrollIntoView==='function'){tr.scrollIntoView({block:'center',behavior:'smooth'})}}},row:function(e){e.preventDefault();var selected=this.hasAttribute('data-infected');var rows=this.parentNode.querySelectorAll('tr');for(var i=0;i<rows.length;i++){rows[i].removeAttribute('data-infected')}
app.create();if(selected===!1){app.set_color(this,this.getAttribute('data-cases'))
app.hide_lads(this.getAttribute('data-region'))}},header:function(table,order){var thead=document.createElement('thead');table.appendChild(thead);var tr=document.createElement('tr');thead.appendChild(tr);for(var i=0;i<order.length;i++){var td=document.createElement('td');td.textContent=order[i];tr.appendChild(td)}},footer:function(table,order,total){var tfoot=document.createElement('tfoot');table.appendChild(tfoot);var tr=document.createElement('tr');tfoot.appendChild(tr);for(var i=0;i<order.length;i++){var td=document.createElement('td');tr.appendChild(td);if(order[i]==='region'){td.textContent='total';continue}
td.textContent=total[order[i]]}},create_table:function(){var data=app.data;var table=document.createElement('table');var order=['region','cases','death','recovered'];app.header(table,order);var total=[];var tbody=document.createElement('tbody');table.appendChild(tbody);for(var i=0;i<data.length;i++){var tr=document.createElement('tr');tr.addEventListener('click',app.row);for(key in data[i]){var td=document.createElement('td');td.textContent=data[i][key];tr.setAttribute('data-'+key,data[i][key]);tr.appendChild(td);if(key==='region'){continue}
total[key]=parseInt(data[i][key])+(total[key]||0)}
tbody.appendChild(tr)}
app.footer(table,order,total);var info=document.createElement('div');info.classList.add('info');info.appendChild(table);app.map.insertBefore(info,app.map.firstChild)},tooltip:function(land,info){var element=document.getElementById('tooltip');land.addEventListener('mousemove',function(event){element.style.left=event.clientX+'px';element.style.top=event.clientY+'px';element.innerHTML='Country: '+info.region+'<br/> Cases: '+info.cases+"<br/> Deaths: "+info.death+"<br/> Recovered: "+info.recovered;element.classList.add('active')});land.addEventListener('mouseout',function(){element.classList.remove('active')});land.addEventListener('mousedown',function(){element.classList.remove('active')})},create:function(){var data=app.data;for(var i=0;i<data.length;i++){var info=data[i];var land=app.map.querySelector('svg [title="'+info.region+'"]');if(land!==null){app.set_color(land,info.cases);app.tooltip(land,info);land.addEventListener('click',app.land)}}},build:function(data){app.data=data;if(app.data.length>0){app.create_table()}
app.create();app.map.classList.add('canvis')},create_widget:function(data)
{app.data=data;if(app.data.length>0){for(x=0;x<app.widgets.length;x++){var widget_country=app.widgets[x].getAttribute("data-country");var cases=app.widgets[x].querySelectorAll('.covid19-confirmed .covid19-value');var deaths=app.widgets[x].querySelectorAll('.covid19-deaths .covid19-value');var recovered=app.widgets[x].querySelectorAll('.covid19-recovered .covid19-value');var total=[];for(var i=0;i<data.length;i++){var set_data=!1;var cdata=[];for(key in data[i]){if(key==='region'){if(data[i][key].toLowerCase()===widget_country.toLowerCase())
{set_data=!0}
continue}
cdata.push(data[i][key]);total[key]=parseInt(data[i][key])+(total[key]||0)}
if(set_data===!0)
{cases[0].innerHTML=cdata[0];deaths[0].innerText=cdata[1];recovered[0].innerText=cdata[2]}}
if(widget_country=="total")
{cases[0].innerHTML=total.cases;deaths[0].innerText=total.death;recovered[0].innerText=total.recovered}}}},get_data:function(){var xhr=new XMLHttpRequest();xhr.open('GET','https://salamzadeh.net/api/get_covid19_map_file.json?time='+new Date().getTime(),!0);xhr.responseType='json';xhr.onload=function(){if(xhr.status===200){if(app.widgets!=null)
app.create_widget(xhr.response);if(app.map!=null)
app.build(xhr.response);return"get data complete "}
app.error("Wrong request status")}
xhr.onerror=function(){app.error("Can't load data.json file")}
xhr.send()},start:function(){app.get_data()}}
app.start()